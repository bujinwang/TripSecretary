# 出国啰 - 项目总结（精简版）

> **项目状态**: 技术选型完成，准备开始开发  
> **APP名称**: 出国啰 ✈️

---

## 一、项目概述

**产品名称**: 出国啰 (ChuGuoLo)  
**英文名**: GoAbroad  
**Slogan**: "出国啰，扫一扫！"  
**核心功能**: 扫描护照 → AI生成入境表格 → 多语言Q&A卡片  
**目标用户**: 中老年旅行者、频繁出境商务人士  
**支持目的地**: 香港、台湾、泰国、美国、加拿大（5个）  
**吉祥物**: 小飞机 ✈️  
**配色**: 天空蓝 #4A90E2 + 活力橙 #FF9500

---

## 二、最终技术栈

### 前端
```
React Native + Expo
- 支持所有国产手机（华为/小米/OPPO/vivo）
- 鸿蒙系统100%兼容
```

### 用户认证
```
主要: 微信登录（覆盖13亿用户）
备用: 手机号+SMS
成本: ¥300/年（微信认证）
```

### 后端（核心决策）⭐
```
Cloudflare Workers - API服务器
Cloudflare D1 - 主数据库（SQLite）
Cloudflare KV - 缓存存储
Cloudflare R2 - 文件存储

关键优势:
✅ 完全免费（10万次/天额度）
✅ 超快速度（<10ms延迟）
✅ 全球300+节点
✅ 零运维
```

### AI服务（国产）
```
主力: 阿里通义千问 Qwen-Max
备用: 百度文心一言 ERNIE 4.0
成本: ¥0.04/1k tokens

❌ 不用Claude/GPT（中国被墙）
```

### OCR
```
主力: PaddleOCR（本地，免费）
备用: 阿里云OCR（¥0.15/次）
```

### 翻译
```
主力: 本地缓存库（1000+短语，免费）
备用: 百度翻译（¥49/100万字符）
```

### 支付
```
微信支付（0.6%手续费）
```

---

## 三、关键技术决策

### 1. 为什么选Cloudflare全套？

| 对比项 | Cloudflare | Supabase |
|--------|-----------|----------|
| **延迟** | <1ms | 200-400ms |
| **成本** | ¥0 | ¥100/月 |
| **管理** | 一个平台 | 两个平台 |

**节省**: ¥100/月 = ¥1,200/年

### 2. 为什么用国产AI？

```
Claude/GPT: ❌ 中国完全无法访问
通义千问: ✅ 100%可用，便宜50%
```

### 3. 为什么用微信登录？

```
Google登录: ❌ 华为手机（23%用户）不支持
微信登录: ✅ 100%国产手机支持
```

---

## 四、数据架构

```
本地（APP内）:
├── SQLite - 离线证件、政策库
├── MMKV - 高速缓存
└── AsyncStorage - 配置

云端（Cloudflare）:
├── D1 - 用户、证件、订单、历史
├── KV - 翻译缓存、政策库
└── R2 - 护照照片、生成的PDF
```

---

## 五、成本预算

### 开发期（6个月）
```
微信认证: ¥300
AI测试: ¥500
Cloudflare: ¥0（免费）
域名: ¥100
─────────────
总计: ¥900
```

### 运营期（月度）

**1000用户/月:**
```
通义千问: ¥140
百度翻译: ¥12
阿里云OCR: ¥15
百度云SMS: ¥60
Cloudflare: ¥0
─────────────
总计: ¥227（单用户¥0.23）
```

**10000用户/月:**
```
总计: ¥2,270（单用户¥0.23）
Cloudflare仍然免费！
```

---

## 六、核心功能流程

```
1. 用户微信登录
2. 扫描护照（PaddleOCR本地识别）
3. 选择目的地（香港/台湾/泰国/美国/加拿大）
4. AI生成入境表格（通义千问）
5. 生成Q&A卡片（中文+目的地语言）
6. 保存到本地SQLite（离线可用）
7. 备份到云端D1（多设备同步）
```

---

## 七、数据库设计（D1）

```sql
-- 用户表
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  wechat_openid TEXT UNIQUE,
  nickname TEXT,
  avatar TEXT,
  is_vip INTEGER DEFAULT 0,
  vip_expiry DATETIME,
  credits INTEGER DEFAULT 3,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 证件表（敏感字段加密）
CREATE TABLE passports (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER REFERENCES users(id),
  encrypted_passport_no TEXT,
  encrypted_name TEXT,
  nationality TEXT,
  expiry DATE,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 生成历史
CREATE TABLE generation_history (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER REFERENCES users(id),
  destination TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 订单表
CREATE TABLE orders (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  order_id TEXT UNIQUE,
  user_id INTEGER REFERENCES users(id),
  product_id TEXT,
  amount REAL,
  status TEXT DEFAULT 'PENDING',
  transaction_id TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  paid_at DATETIME
);
```

---

## 八、安全与合规

### 加密
```
4层加密:
1. 传输层: TLS 1.3
2. 存储层: D1自动AES-256
3. 应用层: 敏感字段额外加密
4. 本地层: SQLite加密
```

### 合规
```
GDPR: ✅ Cloudflare完全合规
PIPL: ✅ 敏感数据本地优先
ISO 27001: ✅
SOC 2 Type II: ✅
```

---

## 九、定价策略

```
免费版:
- 每月3次生成
- 基础功能

高级会员（主推）:
- ¥99/年（仅¥8.25/月）
- 无限次生成
- 优先AI处理
- 云端同步

月度会员:
- ¥12/月（引导用户买年费）

单次购买:
- 10次: ¥9.9
- 50次: ¥39.9
```

---

## 十、已完成文档

```
✅ 智能出入境助手-产品设计文档.md
✅ 技术栈最终确定版.md
✅ 最终技术栈确认.md
✅ 微信登录集成方案.md
✅ 微信支付集成方案.md
✅ React-Native国产手机兼容性分析.md
✅ AI模型跨境调用解决方案.md
✅ 全球网络访问方案.md
✅ Cloudflare-Workers详解.md
✅ Cloudflare数据库选项.md
✅ 数据安全与合规方案.md
✅ UI设计规范.md
✅ 文档更新清单.md
```

---

## 十一、下一步行动

### 立即开始

```
Week 1: 基础设置
□ 注册Cloudflare账号
□ 安装Wrangler CLI: npm install -g wrangler
□ 创建D1数据库: wrangler d1 create trip-secretary
□ 申请微信开放平台（¥300认证）
□ 申请阿里云通义千问API
□ 申请百度翻译API

Week 2: 后端开发
□ 设计D1表结构（见上面SQL）
□ 实现Workers API框架
□ 集成微信登录
□ 集成通义千问AI
□ 实现文件上传到R2

Week 3-4: 前端开发
□ npx create-expo-app trip-secretary
□ 集成react-native-wechat-lib
□ 实现登录页面
□ 实现证件扫描（PaddleOCR）
□ 实现本地SQLite
□ 连接后端API

Week 5-6: 核心功能
□ 实现表格生成
□ 实现Q&A卡片
□ 实现翻译功能
□ 实现离线模式
□ 实现云端同步

Week 7-8: 测试上线
□ 真机测试（华为/小米/OPPO）
□ 性能优化
□ Bug修复
□ 应用商店上架
```

### 必需账号

```
□ Cloudflare账号 - https://dash.cloudflare.com
□ 微信开放平台 - https://open.weixin.qq.com
□ 阿里云账号 - https://dashscope.aliyun.com
□ 百度账号 - https://cloud.baidu.com
□ 注册域名 - chuguoluo.com
□ 注册商标 - "出国啰"
```

---

## 十二、快速命令

### Cloudflare部署

```bash
# 安装CLI
npm install -g wrangler

# 登录
wrangler login

# 创建数据库
wrangler d1 create trip-secretary

# 创建表
wrangler d1 execute trip-secretary --file=schema.sql

# 部署Worker
wrangler deploy

# 查看日志
wrangler tail
```

### React Native开发

```bash
# 创建项目
npx create-expo-app trip-secretary

# 安装依赖
npm install react-native-wechat-lib
npm install expo-sqlite
npm install @react-native-async-storage/async-storage

# 运行
npx expo start

# iOS
npx expo run:ios

# Android
npx expo run:android
```

---

## 十三、关键配置

### wrangler.toml

```toml
name = "trip-secretary"
main = "src/index.js"
compatibility_date = "2024-01-01"

[[d1_databases]]
binding = "DB"
database_name = "trip-secretary"
database_id = "your-db-id"

[[kv_namespaces]]
binding = "MY_KV"
id = "your-kv-id"

[[r2_buckets]]
binding = "MY_BUCKET"
bucket_name = "trip-secretary-files"
```

### 环境变量（使用wrangler secret）

```bash
wrangler secret put QWEN_API_KEY
wrangler secret put WECHAT_APP_ID
wrangler secret put WECHAT_APP_SECRET
wrangler secret put WECHAT_MCHID
wrangler secret put WECHAT_API_KEY
wrangler secret put ENCRYPTION_KEY
```

---

## 十四、重要提醒

### 性能目标
```
- 证件识别: <2秒
- AI生成: <5秒
- 页面加载: <1秒
- 数据库查询: <10ms
```

### 关键指标
```
- 识别准确率: >95%
- 生成成功率: >99%
- APP崩溃率: <0.1%
- 用户留存率: >60%（7天）
```

### 不要做的事
```
❌ 不要用Claude/GPT（被墙）
❌ 不要用Google服务（华为不支持）
❌ 不要用Supabase（Cloudflare更好）
❌ 不要硬编码API密钥
❌ 不要明文存储敏感信息
```

---

## 十五、联系方式与资源

### 官方文档
```
Cloudflare Workers: https://developers.cloudflare.com/workers/
React Native: https://reactnative.dev/
Expo: https://docs.expo.dev/
微信开放平台: https://open.weixin.qq.com/
通义千问: https://help.aliyun.com/zh/dashscope/
```

### 社区资源
```
React Native中文网: https://reactnative.cn/
Cloudflare Discord: https://discord.gg/cloudflaredev
```

---

## 十六、项目文件结构

```
/TripSecretary
├── /app                    # React Native前端
│   ├── /screens           # 页面
│   ├── /components        # 组件
│   ├── /services          # 服务（API、微信、支付）
│   ├── /lib               # 工具库（加密、SQLite）
│   └── package.json
│
├── /workers               # Cloudflare Workers后端
│   ├── /src
│   │   ├── index.js      # 主入口
│   │   ├── auth.js       # 认证
│   │   ├── ai.js         # AI调用
│   │   └── payment.js    # 支付
│   └── wrangler.toml     # 配置
│
├── /database              # 数据库
│   ├── schema.sql        # 表结构
│   └── migrations/       # 迁移文件
│
└── /docs                  # 文档（本目录）
    ├── 产品设计文档.md
    ├── 技术栈确定版.md
    ├── UI设计规范.md
    └── 项目总结.md
```

---

## 十七、技术栈总览图

```
┌─────────────────────────────────────┐
│   React Native APP (前端)          │
│   - 微信登录                        │
│   - 本地SQLite（离线）             │
│   - PaddleOCR（本地OCR）           │
└──────────────┬──────────────────────┘
               │ HTTPS
               ↓
┌─────────────────────────────────────┐
│   Cloudflare Workers (后端)        │
│   - API服务器（全球300+节点）      │
│   - <10ms延迟                      │
└──────────────┬──────────────────────┘
               │
        ┌──────┼──────┐
        ↓      ↓      ↓
    ┌────┐ ┌────┐ ┌────┐
    │ D1 │ │ KV │ │ R2 │
    │数据│ │缓存│ │文件│
    └────┘ └────┘ └────┘
               │
               ↓
┌─────────────────────────────────────┐
│   外部API                           │
│   - 阿里通义千问（AI）              │
│   - 百度翻译（翻译）                │
│   - 阿里云OCR（备用OCR）           │
│   - 微信支付（收款）                │
└─────────────────────────────────────┘
```

---

## ✅ 准备开始开发

**所有技术决策已完成，所有文档已就绪，现在可以开始编码了！**

**建议第一步**: 
1. 注册Cloudflare账号
2. 创建第一个Worker
3. 创建D1数据库
4. 测试"Hello World"

---

**文档版本：** v1.0  
**创建日期：** 2025-06-01  
**项目状态：** ✅ 技术选型完成，准备开发

---

END OF DOCUMENT
