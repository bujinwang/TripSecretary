# å‡ºå¢ƒé€š - å®Œæ•´å®ç°è®¡åˆ’

## ğŸ“‹ æ€»è§ˆ

**ç›®æ ‡**: å°† MVP UI åŸå‹è½¬æ¢ä¸ºå®Œæ•´å¯ç”¨çš„åº”ç”¨
**æ—¶é—´**: 4-6 å‘¨
**çŠ¶æ€**: å‡†å¤‡å¼€å§‹

---

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·è®¾å¤‡                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   React Native App (Expo)                    â”‚  â”‚
â”‚  â”‚   - UI/UX (å·²å®Œæˆ âœ…)                        â”‚  â”‚
â”‚  â”‚   - å¯¼èˆª (å·²å®Œæˆ âœ…)                         â”‚  â”‚
â”‚  â”‚   - çŠ¶æ€ç®¡ç† (å¾…å®ç°)                       â”‚  â”‚
â”‚  â”‚   - API å®¢æˆ·ç«¯ (å¾…å®ç°)                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†• HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cloudflare Workers                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   API è·¯ç”±                                   â”‚  â”‚
â”‚  â”‚   - /api/auth/*        (ç™»å½•/æ³¨å†Œ)          â”‚  â”‚
â”‚  â”‚   - /api/ocr/*         (OCR è¯†åˆ«)           â”‚  â”‚
â”‚  â”‚   - /api/generate/*    (AI ç”Ÿæˆ)            â”‚  â”‚
â”‚  â”‚   - /api/history/*     (å†å²è®°å½•)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†•              â†•              â†•
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ D1 æ•°æ®åº“ â”‚   â”‚ R2 å­˜å‚¨  â”‚   â”‚ å¤–éƒ¨ API â”‚
    â”‚          â”‚   â”‚          â”‚   â”‚          â”‚
    â”‚ - users  â”‚   â”‚ - PDFs   â”‚   â”‚ - é˜¿é‡ŒOCRâ”‚
    â”‚ - docs   â”‚   â”‚ - images â”‚   â”‚ - é€šä¹‰åƒé—®â”‚
    â”‚ - historyâ”‚   â”‚ - backupsâ”‚   â”‚ - å¾®ä¿¡SDKâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Phase 1: åç«¯åŸºç¡€è®¾æ–½ (Week 1-2)

### Week 1: Cloudflare Workers è®¾ç½®

#### 1.1 é¡¹ç›®åˆå§‹åŒ–
```bash
# åˆ›å»º Workers é¡¹ç›®
mkdir cloudflare-backend
cd cloudflare-backend
npm create cloudflare@latest

# é€‰æ‹©:
# - Template: "Hello World" worker
# - TypeScript: Yes
# - Git: Yes
```

#### 1.2 é¡¹ç›®ç»“æ„
```
cloudflare-backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # ä¸»å…¥å£
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ ocr.ts            # OCR è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ generate.ts       # AI ç”Ÿæˆè·¯ç”±
â”‚   â”‚   â””â”€â”€ history.ts        # å†å²è®°å½•è·¯ç”±
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ alibaba-ocr.ts    # é˜¿é‡Œäº‘ OCR
â”‚   â”‚   â”œâ”€â”€ qwen-ai.ts        # é€šä¹‰åƒé—® AI
â”‚   â”‚   â”œâ”€â”€ wechat.ts         # å¾®ä¿¡ SDK
â”‚   â”‚   â””â”€â”€ pdf.ts            # PDF ç”Ÿæˆ
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ schema.sql        # D1 æ•°æ®åº“æ¶æ„
â”‚   â”‚   â””â”€â”€ queries.ts        # æ•°æ®åº“æŸ¥è¯¢
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ auth.ts           # JWT è®¤è¯
â”‚       â””â”€â”€ validation.ts     # æ•°æ®éªŒè¯
â”œâ”€â”€ wrangler.toml             # Cloudflare é…ç½®
â””â”€â”€ package.json
```

#### 1.3 D1 æ•°æ®åº“æ¶æ„

**æ–‡ä»¶**: `src/db/schema.sql`

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  wechat_openid TEXT UNIQUE,
  phone TEXT,
  name TEXT,
  avatar_url TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- æŠ¤ç…§è¡¨
CREATE TABLE passports (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  type TEXT NOT NULL, -- 'china_passport', 'hk_passport', 'hk_permit', 'tw_permit'
  passport_no TEXT NOT NULL,
  name TEXT NOT NULL,
  name_en TEXT,
  gender TEXT,
  birth_date TEXT,
  nationality TEXT,
  issue_date TEXT,
  expiry_date TEXT,
  issue_place TEXT,
  ocr_data TEXT, -- JSON å­˜å‚¨å®Œæ•´ OCR ç»“æœ
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ç”Ÿæˆè®°å½•è¡¨
CREATE TABLE generations (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  passport_id INTEGER NOT NULL,
  destination_id TEXT NOT NULL, -- 'hk', 'tw', 'th', 'us', etc.
  destination_name TEXT NOT NULL,
  flight_number TEXT,
  arrival_date TEXT,
  hotel_name TEXT,
  hotel_address TEXT,
  contact_phone TEXT,
  stay_duration TEXT,
  travel_purpose TEXT,
  additional_data TEXT, -- JSON å­˜å‚¨é¢å¤–ä¿¡æ¯
  status TEXT DEFAULT 'completed', -- 'processing', 'completed', 'failed'
  result_data TEXT, -- JSON å­˜å‚¨ç”Ÿæˆçš„è¡¨æ ¼æ•°æ®
  pdf_url TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (passport_id) REFERENCES passports(id)
);

-- ç”Ÿæˆå†å²ç´¢å¼•
CREATE INDEX idx_generations_user ON generations(user_id, created_at DESC);
CREATE INDEX idx_generations_duplicate ON generations(passport_id, destination_id, flight_number, arrival_date);

-- å®¶åº­æˆå‘˜è¡¨ (V1.1)
CREATE TABLE family_members (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  family_id INTEGER NOT NULL,
  user_id INTEGER NOT NULL,
  role TEXT NOT NULL, -- 'owner', 'assistant', 'viewer'
  added_by INTEGER,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

#### 1.4 åˆ›å»º D1 æ•°æ®åº“

```bash
# åˆ›å»º D1 æ•°æ®åº“
npx wrangler d1 create chujingtong-db

# è¾“å‡ºä¼šç»™ä½ ä¸€ä¸ª database_idï¼Œæ·»åŠ åˆ° wrangler.toml

# æ‰§è¡Œ schema
npx wrangler d1 execute chujingtong-db --file=./src/db/schema.sql
```

**wrangler.toml** é…ç½®:

```toml
name = "chujingtong-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# D1 æ•°æ®åº“
[[d1_databases]]
binding = "DB"
database_name = "chujingtong-db"
database_id = "your-database-id-here"

# R2 å­˜å‚¨
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "chujingtong-storage"

# ç¯å¢ƒå˜é‡
[vars]
ENVIRONMENT = "production"

# å¯†é’¥ (ä½¿ç”¨ wrangler secret è®¾ç½®)
# - ALIBABA_OCR_KEY
# - ALIBABA_OCR_SECRET
# - QWEN_API_KEY
# - WECHAT_APP_ID
# - WECHAT_APP_SECRET
# - JWT_SECRET
```

---

### Week 2: æ ¸å¿ƒ API å®ç°

#### 2.1 è®¤è¯ API

**æ–‡ä»¶**: `src/routes/auth.ts`

```typescript
// POST /api/auth/wechat
// å¾®ä¿¡ç™»å½•
export async function wechatLogin(request: Request, env: Env) {
  const { code } = await request.json();
  
  // 1. ä½¿ç”¨ code æ¢å– openid
  const wechatResponse = await fetch(
    `https://api.weixin.qq.com/sns/jscode2session?` +
    `appid=${env.WECHAT_APP_ID}&` +
    `secret=${env.WECHAT_APP_SECRET}&` +
    `js_code=${code}&` +
    `grant_type=authorization_code`
  );
  
  const { openid, session_key } = await wechatResponse.json();
  
  // 2. æŸ¥æ‰¾æˆ–åˆ›å»ºç”¨æˆ·
  let user = await env.DB.prepare(
    'SELECT * FROM users WHERE wechat_openid = ?'
  ).bind(openid).first();
  
  if (!user) {
    // åˆ›å»ºæ–°ç”¨æˆ·
    const result = await env.DB.prepare(
      'INSERT INTO users (wechat_openid) VALUES (?) RETURNING *'
    ).bind(openid).first();
    user = result;
  }
  
  // 3. ç”Ÿæˆ JWT token
  const token = await generateJWT(user.id, env.JWT_SECRET);
  
  return new Response(JSON.stringify({
    token,
    user: {
      id: user.id,
      name: user.name,
      avatar: user.avatar_url,
    }
  }), {
    headers: { 'Content-Type': 'application/json' }
  });
}

// POST /api/auth/phone
// æ‰‹æœºå·ç™»å½•
export async function phoneLogin(request: Request, env: Env) {
  const { phone, code } = await request.json();
  
  // TODO: éªŒè¯çŸ­ä¿¡éªŒè¯ç 
  
  // æŸ¥æ‰¾æˆ–åˆ›å»ºç”¨æˆ·
  let user = await env.DB.prepare(
    'SELECT * FROM users WHERE phone = ?'
  ).bind(phone).first();
  
  if (!user) {
    const result = await env.DB.prepare(
      'INSERT INTO users (phone) VALUES (?) RETURNING *'
    ).bind(phone).first();
    user = result;
  }
  
  const token = await generateJWT(user.id, env.JWT_SECRET);
  
  return new Response(JSON.stringify({ token, user }), {
    headers: { 'Content-Type': 'application/json' }
  });
}
```

#### 2.2 OCR API

**æ–‡ä»¶**: `src/routes/ocr.ts`

```typescript
import { AlibabaOCR } from '../services/alibaba-ocr';

// POST /api/ocr/passport
// è¯†åˆ«æŠ¤ç…§
export async function recognizePassport(request: Request, env: Env) {
  const formData = await request.formData();
  const imageFile = formData.get('image');
  
  if (!imageFile) {
    return new Response('Missing image', { status: 400 });
  }
  
  // 1. ä¸Šä¼ åˆ° R2 ä¸´æ—¶å­˜å‚¨
  const imageBuffer = await imageFile.arrayBuffer();
  const imageKey = `temp/passport-${Date.now()}.jpg`;
  await env.STORAGE.put(imageKey, imageBuffer);
  
  // 2. è°ƒç”¨é˜¿é‡Œäº‘ OCR
  const ocr = new AlibabaOCR(env.ALIBABA_OCR_KEY, env.ALIBABA_OCR_SECRET);
  const result = await ocr.recognizePassport(imageBuffer);
  
  // 3. è§£æç»“æœ
  const passportData = {
    type: result.type,
    passportNo: result.passport_no,
    name: result.name,
    nameEn: result.name_en,
    gender: result.gender,
    birthDate: result.birth_date,
    nationality: result.nationality,
    issueDate: result.issue_date,
    expiryDate: result.expiry_date,
    issuePlace: result.issue_place,
    raw: result,
  };
  
  return new Response(JSON.stringify(passportData), {
    headers: { 'Content-Type': 'application/json' }
  });
}

// POST /api/ocr/ticket
// è¯†åˆ«æœºç¥¨
export async function recognizeTicket(request: Request, env: Env) {
  const formData = await request.formData();
  const imageFile = formData.get('image');
  
  const imageBuffer = await imageFile.arrayBuffer();
  const ocr = new AlibabaOCR(env.ALIBABA_OCR_KEY, env.ALIBABA_OCR_SECRET);
  const result = await ocr.recognizeTicket(imageBuffer);
  
  return new Response(JSON.stringify({
    flightNumber: result.flight_number,
    arrivalDate: result.arrival_date,
    departureCity: result.departure_city,
    arrivalCity: result.arrival_city,
  }), {
    headers: { 'Content-Type': 'application/json' }
  });
}

// POST /api/ocr/hotel
// è¯†åˆ«é…’åº—é¢„è®¢å•
export async function recognizeHotel(request: Request, env: Env) {
  const formData = await request.formData();
  const imageFile = formData.get('image');
  
  const imageBuffer = await imageFile.arrayBuffer();
  const ocr = new AlibabaOCR(env.ALIBABA_OCR_KEY, env.ALIBABA_OCR_SECRET);
  const result = await ocr.recognizeHotel(imageBuffer);
  
  return new Response(JSON.stringify({
    hotelName: result.hotel_name,
    address: result.address,
    phone: result.phone,
    checkIn: result.check_in,
    checkOut: result.check_out,
  }), {
    headers: { 'Content-Type': 'application/json' }
  });
}
```

#### 2.3 AI ç”Ÿæˆ API

**æ–‡ä»¶**: `src/routes/generate.ts`

```typescript
import { QwenAI } from '../services/qwen-ai';
import { generatePDF } from '../services/pdf';

// POST /api/generate
// ç”Ÿæˆå…¥å¢ƒè¡¨æ ¼
export async function generateEntryForm(request: Request, env: Env) {
  const userId = request.headers.get('X-User-ID'); // ä» JWT æå–
  const {
    passportId,
    destination,
    travelInfo,
  } = await request.json();
  
  // 1. è·å–æŠ¤ç…§ä¿¡æ¯
  const passport = await env.DB.prepare(
    'SELECT * FROM passports WHERE id = ? AND user_id = ?'
  ).bind(passportId, userId).first();
  
  if (!passport) {
    return new Response('Passport not found', { status: 404 });
  }
  
  // 2. æ£€æŸ¥é‡å¤
  const duplicate = await env.DB.prepare(
    `SELECT * FROM generations 
     WHERE passport_id = ? AND destination_id = ? 
     AND flight_number = ? AND arrival_date = ?
     LIMIT 1`
  ).bind(
    passportId,
    destination.id,
    travelInfo.flightNumber,
    travelInfo.arrivalDate
  ).first();
  
  if (duplicate) {
    return new Response(JSON.stringify({
      duplicate: true,
      existingId: duplicate.id,
    }), {
      status: 409,
      headers: { 'Content-Type': 'application/json' }
    });
  }
  
  // 3. è°ƒç”¨ AI ç”Ÿæˆ
  const ai = new QwenAI(env.QWEN_API_KEY);
  const entryForm = await ai.generateEntryForm({
    passport,
    destination,
    travelInfo,
  });
  
  // 4. ç”Ÿæˆ PDF
  const pdfBuffer = await generatePDF(entryForm);
  const pdfKey = `pdfs/${userId}/${Date.now()}-${destination.id}.pdf`;
  await env.STORAGE.put(pdfKey, pdfBuffer);
  const pdfUrl = `https://storage.chujingtong.com/${pdfKey}`;
  
  // 5. ä¿å­˜åˆ°æ•°æ®åº“
  const generation = await env.DB.prepare(
    `INSERT INTO generations (
      user_id, passport_id, destination_id, destination_name,
      flight_number, arrival_date, hotel_name, hotel_address,
      contact_phone, stay_duration, travel_purpose,
      additional_data, status, result_data, pdf_url
    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    RETURNING *`
  ).bind(
    userId,
    passportId,
    destination.id,
    destination.name,
    travelInfo.flightNumber,
    travelInfo.arrivalDate,
    travelInfo.hotelName,
    travelInfo.hotelAddress,
    travelInfo.contactPhone,
    travelInfo.stayDuration,
    travelInfo.travelPurpose,
    JSON.stringify(travelInfo),
    'completed',
    JSON.stringify(entryForm),
    pdfUrl
  ).first();
  
  return new Response(JSON.stringify({
    id: generation.id,
    entryForm,
    pdfUrl,
    createdAt: generation.created_at,
  }), {
    headers: { 'Content-Type': 'application/json' }
  });
}
```

---

## ğŸ“± Phase 2: å‰ç«¯é›†æˆ (Week 3-4)

### Week 3: API å®¢æˆ·ç«¯å’ŒçŠ¶æ€ç®¡ç†

#### 3.1 åˆ›å»º API å®¢æˆ·ç«¯

**æ–‡ä»¶**: `app/services/api.js`

```javascript
const API_BASE_URL = 'https://api.chujingtong.com';

class ApiClient {
  constructor() {
    this.token = null;
  }

  setToken(token) {
    this.token = token;
  }

  async request(endpoint, options = {}) {
    const headers = {
      'Content-Type': 'application/json',
      ...options.headers,
    };

    if (this.token) {
      headers['Authorization'] = `Bearer ${this.token}`;
    }

    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
      ...options,
      headers,
    });

    if (!response.ok) {
      throw new Error(`API Error: ${response.status}`);
    }

    return response.json();
  }

  // è®¤è¯
  async wechatLogin(code) {
    return this.request('/api/auth/wechat', {
      method: 'POST',
      body: JSON.stringify({ code }),
    });
  }

  // OCR
  async recognizePassport(imageUri) {
    const formData = new FormData();
    formData.append('image', {
      uri: imageUri,
      type: 'image/jpeg',
      name: 'passport.jpg',
    });

    return this.request('/api/ocr/passport', {
      method: 'POST',
      headers: { 'Content-Type': 'multipart/form-data' },
      body: formData,
    });
  }

  async recognizeTicket(imageUri) {
    const formData = new FormData();
    formData.append('image', {
      uri: imageUri,
      type: 'image/jpeg',
      name: 'ticket.jpg',
    });

    return this.request('/api/ocr/ticket', {
      method: 'POST',
      headers: { 'Content-Type': 'multipart/form-data' },
      body: formData,
    });
  }

  // ç”Ÿæˆ
  async generateEntryForm(data) {
    return this.request('/api/generate', {
      method: 'POST',
      body: JSON.stringify(data),
    });
  }

  // å†å²è®°å½•
  async getHistory() {
    return this.request('/api/history');
  }
}

export default new ApiClient();
```

#### 3.2 å®ç°ç›¸æœºåŠŸèƒ½

**æ–‡ä»¶**: `app/screens/ScanPassportScreen.js` (æ›´æ–°)

```javascript
import { Camera } from 'expo-camera';
import * as ImagePicker from 'expo-image-picker';
import api from '../services/api';

const [hasPermission, setHasPermission] = useState(null);
const [scanning, setScanning] = useState(false);
const cameraRef = useRef(null);

// è¯·æ±‚æƒé™
useEffect(() => {
  (async () => {
    const { status } = await Camera.requestCameraPermissionsAsync();
    setHasPermission(status === 'granted');
  })();
}, []);

const handleCapture = async () => {
  if (!cameraRef.current) return;
  
  setScanning(true);
  try {
    // æ‹ç…§
    const photo = await cameraRef.current.takePictureAsync({
      quality: 1,
      base64: false,
    });
    
    // OCR è¯†åˆ«
    const result = await api.recognizePassport(photo.uri);
    
    // è·³è½¬åˆ°ä¸‹ä¸€æ­¥
    navigation.navigate('SelectDestination', {
      passport: result,
    });
  } catch (error) {
    Alert.alert('è¯†åˆ«å¤±è´¥', error.message);
  } finally {
    setScanning(false);
  }
};

const handleGallery = async () => {
  const result = await ImagePicker.launchImageLibraryAsync({
    mediaTypes: ImagePicker.MediaTypeOptions.Images,
    quality: 1,
  });
  
  if (!result.canceled) {
    setScanning(true);
    try {
      const ocrResult = await api.recognizePassport(result.assets[0].uri);
      navigation.navigate('SelectDestination', { passport: ocrResult });
    } catch (error) {
      Alert.alert('è¯†åˆ«å¤±è´¥', error.message);
    } finally {
      setScanning(false);
    }
  }
};

return (
  <View style={styles.container}>
    <Camera
      ref={cameraRef}
      style={styles.camera}
      type={Camera.Constants.Type.back}
    >
      {/* æ‰«ææ¡† */}
      <View style={styles.scanFrame} />
    </Camera>
    
    {scanning && (
      <View style={styles.loadingOverlay}>
        <ActivityIndicator size="large" color="#07C160" />
        <Text>è¯†åˆ«ä¸­...</Text>
      </View>
    )}
    
    <View style={styles.controls}>
      <Button title="æ‹ç…§" onPress={handleCapture} />
      <Button title="ç›¸å†Œ" onPress={handleGallery} />
    </View>
  </View>
);
```

---

## ğŸ“¦ æ‰€éœ€çš„ä¾èµ–åŒ…

### åç«¯ (Cloudflare Workers)

```json
{
  "dependencies": {
    "@cloudflare/workers-types": "^4.20241127.0",
    "hono": "^4.0.0",
    "jose": "^5.0.0"
  }
}
```

### å‰ç«¯ (React Native)

```json
{
  "dependencies": {
    "expo-camera": "~13.4.4",
    "expo-image-picker": "~14.3.2",
    "@react-native-async-storage/async-storage": "^1.21.0",
    "expo-file-system": "~15.4.0",
    "expo-sharing": "~11.5.0"
  }
}
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

æˆ‘ç°åœ¨å¯ä»¥å¼€å§‹åˆ›å»º:

1. **Cloudflare Workers åç«¯é¡¹ç›®** - å®Œæ•´çš„ API å®ç°
2. **é˜¿é‡Œäº‘ OCR é›†æˆ** - æŠ¤ç…§ã€æœºç¥¨ã€é…’åº—è¯†åˆ«
3. **é€šä¹‰åƒé—® AI é›†æˆ** - è¡¨æ ¼ç”Ÿæˆ
4. **å‰ç«¯ API å®¢æˆ·ç«¯** - å®Œæ•´è¿æ¥
5. **ç›¸æœºåŠŸèƒ½å®ç°** - expo-camera é›†æˆ

ä½ å¸Œæœ›æˆ‘ä»å“ªä¸€éƒ¨åˆ†å¼€å§‹ï¼Ÿæˆ–è€…ä¸€æ¬¡æ€§åˆ›å»ºæ‰€æœ‰æ–‡ä»¶ï¼Ÿ
